{% extends 'base.html' %}

{% block title %}Panel Usuario | VotaciónApp{% endblock %}

{% block content %}
    <div class="max-w-5xl mx-auto mt-8 mb-12">

        <!-- Bienvenida personalizada (Banner) -->
        <div class="bg-white shadow-lg rounded-2xl overflow-hidden mb-10 border border-gray-100">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 px-6 py-8 sm:p-10 flex items-center justify-between relative">
                <!-- Decoración de fondo -->
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white opacity-10 rounded-full blur-2xl"></div>
                
                <div class="flex items-center relative z-10">
                    {% if persona.foto_url %}
                        <img src="{{ persona.foto_url }}" alt="Foto de {{ persona.nombre }}"
                             class="h-20 w-20 sm:h-24 sm:w-24 rounded-full border-4 border-white/30 shadow-md object-cover mr-6">
                    {% else %}
                         <div class="h-20 w-20 sm:h-24 sm:w-24 rounded-full border-4 border-white/30 shadow-md bg-white/20 flex items-center justify-center text-white text-3xl font-bold mr-6">
                            {{ persona.nombre|first|upper }}
                        </div>
                    {% endif %}
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-white">Hola, {{ persona.nombre }}</h1>
                        <p class="text-blue-100 mt-1 text-sm sm:text-base font-medium">Bienvenido a tu panel de votación</p>
                    </div>
                </div>
                
                <!-- Botón Cerrar Sesión -->
                <div class="relative z-10">
                    <a href="{% url 'logout_votante' %}" class="inline-flex items-center px-4 py-2 border-2 border-white/30 rounded-lg text-sm font-medium text-white hover:bg-white/10 hover:border-white/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white transition-all">
                        <i class="bi bi-box-arrow-right mr-2"></i> Cerrar Sesión
                    </a>
                </div>
            </div>
        </div>

        <!-- Sección: Eventos disponibles -->
        <div class="mb-12">
            <h2 class="text-xl font-bold text-gray-900 mb-5 flex items-center border-b border-gray-200 pb-2">
                <i class="bi bi-broadcast text-green-600 mr-2.5"></i> Eventos Disponibles
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for evento in eventos %}
                    <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 border border-gray-200 overflow-hidden flex flex-col h-full group">
                        <div class="p-6 flex-grow">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-lg font-bold text-gray-900 line-clamp-2 group-hover:text-blue-600 transition-colors">
                                    {{ evento.nombre }}
                                </h3>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200">
                                    Activo
                                </span>
                            </div>
                            
                            <div class="space-y-3 text-sm text-gray-600">
                                <div class="flex items-center p-2 bg-gray-50 rounded-lg">
                                    <i class="bi bi-calendar-check mr-2.5 text-blue-500 text-lg"></i>
                                    <div>
                                        <span class="block text-xs text-gray-400 uppercase font-semibold">Inicio</span>
                                        <span class="font-medium">{{ evento.fecha_inicio|date:"d M Y, H:i" }}</span>
                                    </div>
                                </div>
                                <div class="flex items-center p-2 bg-gray-50 rounded-lg">
                                    <i class="bi bi-calendar-x mr-2.5 text-red-400 text-lg"></i>
                                    <div>
                                        <span class="block text-xs text-gray-400 uppercase font-semibold">Término</span>
                                        <span class="font-medium">{{ evento.fecha_termino|date:"d M Y, H:i" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 px-6 py-4 border-t border-gray-100">
                            <a href="{% url 'votar_evento' evento.id %}" class="block w-full text-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform active:scale-[0.98]">
                                Votar Ahora <i class="bi bi-box-arrow-in-right ml-1.5"></i>
                            </a>
                        </div>
                    </div>
                {% empty %}
                    <div class="col-span-full bg-white rounded-xl shadow-sm p-10 text-center border border-gray-200 border-dashed">
                        <div class="mx-auto h-16 w-16 bg-gray-50 rounded-full flex items-center justify-center mb-4">
                            <i class="bi bi-inbox text-gray-400 text-3xl"></i>
                        </div>
                        <h3 class="text-base font-semibold text-gray-900">No hay eventos activos</h3>
                        <p class="mt-1 text-sm text-gray-500">No hay votaciones disponibles para ti en este momento.</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Sección: Historial de votaciones -->
        <div>
            <h2 class="text-xl font-bold text-gray-900 mb-5 flex items-center border-b border-gray-200 pb-2">
                <i class="bi bi-clock-history text-gray-500 mr-2.5"></i> Historial de Votaciones
            </h2>
            
            <div class="bg-white shadow overflow-hidden sm:rounded-xl border border-gray-200">
                {% if historial and historial|length > 0 %}
                    <ul class="divide-y divide-gray-100">
                        {% for he in historial %}
                            <li class="hover:bg-gray-50 transition-colors duration-150">
                                <div class="px-4 py-4 sm:px-6 flex items-center justify-between flex-wrap gap-4">
                                    <div class="flex items-center min-w-0">
                                        <div class="flex-shrink-0">
                                            <span class="h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 border border-gray-200">
                                                <i class="bi bi-check2-circle text-lg"></i>
                                            </span>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-semibold text-gray-900 truncate">{{ he.nombre }}</p>
                                            <div class="flex items-center text-xs text-gray-500 mt-0.5">
                                                <i class="bi bi-calendar3 mr-1.5"></i>
                                                {{ he.fecha_inicio|date:"d/m/Y" }} - {{ he.fecha_termino|date:"d/m/Y" }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-shrink-0 ml-auto">
                                        {% if he.fecha_termino|date:"U" <= "now"|date:"U" %}
                                            <a href="{% url 'resultados_evento' he.id %}" class="inline-flex items-center px-3.5 py-2 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                                <i class="bi bi-bar-chart-line mr-1.5"></i> Ver Resultados
                                            </a>
                                        {% else %}
                                            <button disabled class="inline-flex items-center px-3.5 py-2 border border-gray-200 shadow-sm text-xs font-medium rounded-md text-gray-400 bg-gray-50 cursor-not-allowed">
                                                <i class="bi bi-bar-chart-line mr-1.5"></i> Ver Resultados
                                            </button>
                                            <span class="text-xs text-gray-500 block mt-1 text-right">Disponible al terminar</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="px-6 py-10 text-center text-gray-500 bg-gray-50">
                        <p class="text-sm">Aún no tienes un historial de votos registrados.</p>
                    </div>
                {% endif %}
            </div>
        </div>

{% endblock %}